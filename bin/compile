#!/usr/bin/env bash

set -e            # fail fast
set -o pipefail   # don't ignore exit codes when piping output
# set -x          # enable debugging

# Configure directories
build_dir=$1
cache_dir=$2
env_dir=$3

bp_dir=$(cd $(dirname $0); cd ..; pwd)

# Load some convenience functions like status(), echo(), and indent()
source $bp_dir/bin/common.sh

status "Downloading and installing ZBAR"
zbar_url="http://iweb.dl.sourceforge.net/project/zbar/zbar/0.10/zbar-0.10.tar.bz2"
curl $zbar_url -s -o - | tar jxf - -C $build_dir

mkdir -p $build_dir/vendor
mv $build_dir/zbar-0.10 $build_dir/vendor/zbar
sh $build_dir/vendor/zbar/configure --without-python --without-qt --without-gtk
make -c $build_dir/vendor/zbar
make install -c $build_dir/vendor/zbar